---
title: 白皮书
description: "Vite: 一个快速无手续费的分布式交易账本"
---

# Vite: 一个快速无手续费的分布式交易账本

> Vite: A fast, feeless, decentralized transaction ledger

## 背景

随着区块链技术的发展，以太坊等去中心化智能合约平台做为分布式应用的基础设施，正在发挥越来越重要的作用。一个运行智能合约的基础平台，在设计目标上必须从以下三个维度中权衡取舍：

* A) 容错性（Fault Tolerance）：防止数据被伪造、篡改
* B) 性能（Performance）：高吞吐，低延迟，扩展性
* C) 经济性（Economy）：无交易手续费或低交易手续费

以太坊的设计目标，是追求极致的安全性。相对应的，在性能和经济性上考虑不足，导致很多dApp受限于以太坊的低吞吐、高延迟以及日渐高昂的gas，而无法大范围应用。

从性能角度分析，以太坊的性能瓶颈主要来自两个方面：

基于区块链的账本结构。这种账本结构本质上是确定所有交易的全局顺序。在现实应用中，很多交易之间的偏序关系并不影响最终的世界状态，这些顺序无关的交易竞争在账本中的位置，造成了严重的性能损耗。
PoW共识算法。目前为止，PoW仍然是容错性最好的BFT算法。但PoW是一种依靠求解数学问题竞争记账权的算法，为降低分叉的概率，两个区块之间的间隔不能太小，这就使得整个系统的交易平均延迟难以被降低。
目前，以太坊社区也提出了若干优化方案，试图提高以太坊的扩展性。例如，基于分层架构的Raiden网络，以及利用侧链优化账本结构的Plasma，将共识算法更改为基于PoS算法的Casper等。

这些方案在技术角度上具有一定的合理性，但在社区治理(governance)层面迄今为止尚未达成共识。一部分人认为这些改进弱化了以太坊的去中心化特质，违背了极致容错性（extreme levels of fault tolerance）的设计初衷，这种分歧最终可能会导致硬分叉。

从经济性角度分析，以太坊主要通过gas来量化每一笔交易所消耗的计算资源，再根据gas price将其折算为以太坊内部代币(Wei或Ether)，从而向交易发起方收取费用。由于以太坊中所有的智能合约和用户账户都是平等的，无法根据应用本身的重要程度和所需的资源配额来差异化定价。随着整个网络节点和交易量的增长，内置代币的成本也在攀升。最终一些轻量级应用将无法承担高昂的交易费用。

以太坊作为单一平台，无论其如何演化，都很难满足所有应用场景对安全性、性能和经济性的差异化需求。因此，我们需要一个兼顾安全性、性能和经济性的智能合约平台，为未来部署在其上的高频应用提供工业级的解决方案。


## 简介

首先我们需要分析平台未来的应用场景，建立一些必要的约束，然后在满足这些约束的前提下，来讨论具体的设计。

考虑到当前以太坊生态已经相对成熟，已经有大量基于Solidity和EVM开发的智能合约运行在以太坊上，提供EVM兼容性将有利于这些存量应用的无缝迁移，也可以使新平台和以太坊未来在技术上相互融合，共同推动区块链和智能合约的技术进化。因此，我们就将EVM兼容性作为新平台的第一约束。

根据上面的分析，我们从账本结构和共识算法两方面入手，解决EVM的性能瓶颈。

我们不再强制任何两笔交易之间进行排序，而只关注影响最终状态的交易顺序。对应到账本结构上，这种用部分有序代替全局有序的结构不再是一个线性结构，而是一个图。因此，我们的账本结构采用DAG（有向无环图）来代替区块链。

那么，到底需要关心哪些交易之间的相对顺序呢？由于世界状态(world state)是账户状态的集合，账户状态之间彼此独立，因此，我们可以天然的将账户作为分组的依据，只对影响某一个账户状态的交易进行排序。按照这个原则，我们将账本设计成多链结构，每个账户对应一条单独的链，每个链上的区块只影响本账户的状态。

在以太坊的协议中，一个交易或消息，可能会影响多个账户的状态。例如一笔转账交易，会使发送方账户余额扣减，同时使接受方余额增加。再如一个合约调用交易，可能会使发送方账户余额扣减，使接受方的合约账户状态发生变化，再通过消息调用(message call)，使第三方的合约账户状态发生变化。因此，在我们的设计中，一个交易必须被拆解成多个区块，以满足每个区块只影响单一账户状态这一约束。根据这一设计，我们将区块分成RequestBlock和ResponseBlock两种。

RequestBlock记录在交易发起方的链上，包含转账的扣款信息、合约调用的参数等。一个合约内部的消息调用指令，也会生成一个RequestBlock。

ResponseBlock记录在交易接收方的链上，必须有唯一一个RequestBlock与之对应，包含转账交易的收款信息，合约调用的返回值等信息。

如果我们将向智能合约发送交易看作是一种对远程服务调用，这种拆分将同步调用转换为异步调用，降低了交易之间的竞争，有利于提高系统的吞吐能力。但EVM的消息调用所产生的跨合约交互，在这种新型账本中实现面临一定的挑战，后文将详细描述这个问题。

在共识机制上，我们选择具有性能优势的DPOS算法，并在此基础上进行扩展，以适应Vite账本的多链结构。

在现实应用中，还有一个容易被忽略的性能瓶颈，就是一些被大量重复使用的通用计算和基础功能，这些计算逻辑实现在智能合约中，不但性能低下，而且复用程度低，容易出错。因此，我们除了扩展Solidty的基础库和EVM的预编译合约之外，还可以将一些通用交易逻辑单独抽象出来，用原生代码实现。这种抽象体现在系统的分层设计中，当这些特定逻辑发布后，用户不需要部署智能合约，就可以直接在Vite之上发行新的代币，或者利用内置的DEX交易不同的币种。

在Vite的设计中，经济性是一个重要的目标。由于采用了无手续费的设计，所以必须充分考虑如何防范系统被滥用或攻击，以及如何激励节点。

## 系统分层

为适应多种应用场景，我们对系统进行了分层设计，包扩：

* 传输层(Transport Layer)：负责处理节点间的网络数据传输；
* 价值层(Value Layer)：维护代币的余额，支持多种代币的发行和转账；
* 交易层(Transaction Layer)：提供一种可扩展的内置协议，支持资产发行、资产交易、环路撮合等更为复杂的交易逻辑；
* 合约层(Contract Layer)：支持图灵完备的智能合约，提供EVM兼容性；


### 价值层

#### 用户账户

用户账户(User Account)，是由外部用户持有，由一组私钥和公钥构成的单元。用户账户的地址由公钥截取最后20个字节产生。用户账户是由外部用户控制的，通过私钥来签名交易。

#### 合约账户
合约账户(Contract Account)，是由智能合约管理的代币账户，具有独立的地址，同样可以拥有自己的余额，但代币的转账并不是通过私钥来签名，而是通过合约代码中的消息调用来完成。

#### 账户余额

无论是用户账户还是合约账户，都有自己的代币余额。账户余额直接记录在账本中，每个账户的余额数据包含该账户所拥有的每种代币的余额。

由于代币种类不唯一，账户余额是一个类似于hash map的结构：

```markdown
UserAccountState: map(address -> map(token_id -> balance))
```

### 交易

我们将一个转账操作分成两笔独立的交易——一个出账交易和一个入账交易。这样拆分有利于提高交易的吞吐，出账交易不需要等到前一笔交易被对方接受，就可以继续发出其他交易；而入账交易也可以在使用该笔余额之前的任意时间延迟加入账本。

一笔交易中可以同时包含多种代币的转账，其中任何一种代币的余额不足，该交易都被认为是无效的。

交易不需要支付手续费。为防止系统被滥用，需要在每笔交易中完成一个简单的PoW。同时，交易是否被系统接受，也受每个账户TPS配额的限制。

#### 出账交易

要从一个用户账户发送代币，用户需要用自己的私钥签名一个出账交易(Send Transaction)。该交易需要引用用户账户对应的链尾部最后一个区块的hash，并确保账户中有足够的余额。

出账交易一旦广播到网络，并被写入账本，对应代币的余额将从账户中扣除，不需要等到接收方接收。在对应的转入交易被记入账本之前，代币属于在途资金。此时，用户可以继续发送或接收代币，不会被前一笔未完成的交易阻塞。

#### 入账交易

要接收另一个账户发送的代币余额，用户需要用自己的私钥签名一个入账交易(Receive Transaction)。该交易需要引用用户账户对应的链尾部最后一个区块的hash。

交易一旦广播到网络，并被写入账本，对应代币的余额将累加到接收账户中。

#### 合约账户的转账

合约账户的转出操作是通过智能合约代码中的transfer指令来触发，和出账交易类似，该指令的执行也会在账本中产生一个区块，并扣除相应的代币余额。如果转账目标是用户账户，则用户可以在接收该笔转账时生成一个对应的入账交易。

合约账户的转入操作，同样需要在账本中加入一个入账区块，引用该合约账户前一区块的hash，以及对应的出账交易的hash。不同的是，该区块并不是由某个用户生成，而是由矿工生成并广播到网络。

## 原生代币
Vite在发布时，会发行一种内置的原生代币VT(Vite Token)，用于记录用户权益、提供激励、传递价值。VT的初始发行量为1,000,000,000。后续，授权参与验证交易、生产区块、执行合约代码并维护账本的矿工会得到额外的VT作为锻造奖励，对节点的激励会使VT的流动性增加；而用户发行新的代币、部署合约、加速交易确认等需要销毁或抵押VT，这些动作会使VT流动性减少。

这个经济模型的作用主要表现在两个方面：

首先是激励节点参与交易验证。因为更多的节点参与会加强系统的安全性和性能，进而使所有用户受益，从这个角度看，适当的通胀是合理的。我们会设定一个奖励上限，确保每年通胀率不高于5%。

另外，一个用户可以通过对VT的销毁和抵押，向其他所有用户支付费用，换取发行新代币或加速交易所需要的存储和计算资源，也降低了系统被滥用的可能。

### 代币发行

VITE支持多种代币，任何用户都可以通过发送一个铸币请求来发行新的代币。铸币请求的格式如下：

```java
Mint {
name: MyToken
   	totalSupply: 99999999900000000000000000
   	decimals: 18
   	owner: 0xa3c1f4...fa
symbol: MYT
signature: 0x21b0ff...77
}
```

一旦该请求被网络接受，规定数量的VT将作为铸币费从铸币者账户扣除，账本会记录新代币的信息，为其分配一个token_id。新生成的代币全部余额都会被加入到owner的地址，或者说，owner是这个代币的genesis账户。

## 交易层

### 交易层合约

为扩展交易层的功能，Vite提供了一个可扩展的内置合约协议。开发者可以通过扩展交易层合约，实现更为复杂的价值交换逻辑。例如，在交易层中可以实现分阶段的资产发行、去中心化代币交易(DEX)、环路撮合(Loopring Protocol)等功能。

交易层合约与合约层的“智能合约”是不同的概念。交易层合约是内置到Vite客户端的代码中，与客户端共同发布，只支持相对固定的功能，不具备图灵完备性；而智能合约是由用户通过合约脚本语言开发，编译成字节码，部署到Vite平台上，在Vite运行时环境中执行，是图灵完备的。

## 合约层

### 智能合约

考虑到以太坊上已有大量的智能合约，Vite合约层选择兼容EVM，以方便用户将以太坊上的dApp迁移到新平台。当然，Vite和以太坊设计的差异，会导致EVM一些细节实现有所不同。例如，Vite没有交易手续费，发往合约的交易和合约的计算都不需要消耗gas；0x40-0x45这一组获取区块信息的指令语义也有所不同。

由于价值层原生支持代币发行，我们不再鼓励用户在合约层通过智能合约发行代币。同样，通过智能合约实现交易层已提供的功能，也是一个得不偿失的选择。

### 合约部署

部署一个智能合约，用户需要向一个空地址发送一个交易，合约的EVM代码包含在交易的data字段中。一旦合约的部署请求被网络接受，系统会生成一个合约地址，并建立该地址对应的区块链的第一个区块。

每个合约在部署时都可以指定一个共识组，并设定一个共识规则，其中包含系统预设的共识算法以及相关参数。如果不显示指定共识组，默认情况下合约将被部署到公有共识组。

部署合约时，用户需要抵押一定数量的VT，抵押VT数量更多的合约，其交易会被优先确认。这样的设计可以满足不同场景的需求，一个更为重要的合约，可以通过抵押更多的VT，换取更高的优先级和TPS配额；而类似于宠物游戏之类的轻量级合约，对快速确认的需求不敏感，就可以选择抵押较少的VT，以降低部署成本。

### 账本结构

Vite的账本是一种多链结构，由RequestBlock和ResponseBlock两种区块构成。每个账户对应一条独立的链，链中后面的区块需要引用前面区块的hash。RequestBlock可以单独存在，而ResponseBlock必须引用唯一一个与之对应的RequestBlock。这种结构本质上是一个DAG(有向无环图)。

我们将一组RequestBlock和ResponseBlock称为对偶块(dual blocks)。在账本中，一个单独存在的RequestBlock称为开放块(open block)；两个对偶块都存在的情况下，两个块被称为闭合块(closed block)。


如上图所示，用户A、B、D各自对应一条链，链中存储的是每一条出账交易(对应一个RequestBlock)和入账交易(对应一个ResponseBlock)。C是一个合约地址，也拥有一条自己的链。通常情况下，大部分合约都不会主动产生RequestBlock，而是根据用户生成的open RequestBlock，生成对偶的ResponseBlock。
但在合约代码中存在消息调用指令的情况下，情况会变得相对复杂。举一个例子，一个用户A向合约B发出一个交易，合约B的代码中通过消息调用，分别向合约C和用户D发出两个消息。这种情况在以太坊中实现比较简单，只需要在账本中持久化原始的交易，所有由合约代码产生的内部交易(消息)都不需要显式的出现。由于所有交易是线性有序的，在每个节点验证交易时，都会以同样的顺序产生新的内部交易，并执行对应的代码，更新相关账户状态，最终总会到达同一个世界状态。而在多链结构下，由于验证不同链上交易的顺序可以是任意的，因此，到达同一个世界状态会有多条可能的路径，其间会经历不同的中间状态。因此，在处理这种情况时，需要引入额外的逻辑。
在Vite中，任何交易都需要被显式的加入账本，包括合约代码所产生的消息。这样，才能确保整个账本中任何块最终都可以找到其对偶块，或者说，任何响应块都能找到原始的请求块，以获取其中转账金额和调用参数等必要信息。
在刚才的例子中，最终账本中会增加下图方框中所包含的6个块。
首先，A会打包一个RequestBlock块a，表示对B的请求。出块节点扫描到a块后，会执行B的代码，生成一个ResponseBlock块b，在执行过程中，B的代码会通过消息调用指令生成两个新的RequestBlock块b1和b2，这两个块将附加在b块后面。其中，b1是对合约C的调用，需要当即执行并返回结果，才能继续B的后续代码执行。因此，同一个出块节点必须继续执行C合约的代码，并生成对应的响应块c。无论c是否生成成功，都需要返回到B的后续代码继续执行完毕。
而b2是一个向用户发出转账交易，因此只需要生成代表出账的RequestBlock即可，不需要等待D生成对应的入账交易块d。
因此，在处理这个合约调用的过程中，出块节点必须同时生成b, b1, b2, c四个块，这四个块的生成不能被中断，不能在其中插入其他交易，也不能由两个节点分别生成。



在其他节点收到这一组块后，验证其有效性时，也需要按照其依赖关系从最初的块开始验证。也就是说必须按调用树的拓扑关系自顶向下依次验证交易。

例如，某个节点准备验证块c，发现c的对偶块是b1，为了验证b1中提供的调用参数是否正确，必须继续回溯到b1的父节点b，执行B的代码。而b的调用参数又来自于其对偶块a，因此还要先验证a的正确性。
因此，无论是这一组块以何种顺序被传输和处理，由于依赖关系的存在，最终总会被以唯一确定的顺序验证。这就保证了EVM的语义在这种DAG账本中仍然是确定的和一致的。

快照链
Vite的一个重要设计是引入一条独立的区块链，称为快照链(Snapshot Chain)。快照链是由快照块(Snapshot Block)构成，每个快照块存储一个账本的状态快照。快照块记录账户的余额、合约账户状态的hash，以及每个账户链中最后一个块的hash。


快照链的引入带来了如下好处：
安全性增强。当攻击者想篡改一个交易，除了需要重新计算账户链上该区块的后继节点，还需要重新计算快照链中该笔交易对应的区块之后的全部区块。即使该账户长期没有后续的交易，但快照链本身在不断增长，因此，篡改交易的成本仍然会随时间推移而逐渐增加。
为多条链上的共识提供检查点。由于每个账户的链上都可能会有新区块被加入账本，当记账节点发生变化时，前后两个节点需要一个检查点来交接每条链上的出块进度。当发生分叉或回滚时，也需要一个检查点来同步回滚每条链上的交易。
提供锻造奖励。由于每个账户的链上出块的速度不一致，锻造奖励只能通过快照链实现。
提供全局时间戳。有了快照链，系统就拥有了一个全局时钟。在某个账户链上，根据两个区块所引用的快照块之间的距离，可以计算出两次请求间隔的时间，可以量化一个账户的TPS，从而使有效的限流机制成为可能。
区块裁剪。由于快照块本身保留了账本的状态信息，一些节点不再需要保存全部历史交易数据，大大降低了账本的存储空间。

共识机制
共识算法
Vite的共识机制称为HHC(Hierarchical Hybrid Consensus)。
参与系统账本维护的节点可分为三种角色：
裁判者(Referee)：拥有最终裁判权，可以对账本中的任何分叉作出选择，并将最终结果记录在快照链中。
出块者(Issuer)：根据某种共识规则，拥有锻造某条链上区块的权力，快照链除外。
验证者(Validator)：验证锻造者产生的区块是否有效，以决定是否将其加入本地账本。根据裁判者的快照信息，决定某个交易是否被系统确认。验证者是“只读”节点，不会产生任何可以改变账本状态的消息。


裁判者
处于共识机制最高层的一组节点称为裁判者，裁判者不生成任何区块，只对接收到的区块进行判断。根据每条链的共识规则，裁判者首先判断该区块是否由合法的出块者签名，并符合共识规则；再判断该链是否发生分叉，如发生分叉，则选择其中一个分叉；最后判断该区块是否满足账户的TPS限额。所有判断均通过后，裁判者将该链最后一个区块，以及该账户的余额信息记录在快照链上。
根据共识规则不同，裁判者决定一个交易是否被快照的策略也不同。例如，一个作为跨链网关的共识组，需要将比特币上的某些交易映射到自己的链上，就可以在生成共识组时，将参数中的确认数设定为6。此时，裁判者会将该链上深度大于6的区块进行快照，而深度小于6的块有可能发生回滚，不会被立即快照。
快照链的共识基于DPOS算法。用户通过一个投票机制，按照每个用户持有的VT份额作为权重，选出21个裁判者。这些裁判节点以随机的顺序轮流生成下一个快照块，快照链的出块间隔为10秒。
由于裁判者是Vite系统最为重要的节点，而且需要验证每条链上的区块，对计算资源消耗较大。为激励用户运行节点，需要提供出块的锻造奖励。我们将锻造奖励总量控制在每年3%之内，以避免VT过度通胀。

交易验证
裁判者节点验证一个交易是否有效，需要验证以下内容：
账本中没有同样的交易存在；
交易必须由公式组中合法的出块者签名；
该交易所引用的前一区块是该账户区块链最末尾的区块，否则这是一个分叉交易；
交易引用的快照块hash是有效的；
交易满足账户TPS限额；
交易的币种是账本中存在的；
如果是出账交易，账户必须有充足的代币余额；
如果是入账交易，其引用的出账交易区块是有效的；
如果交易是由合约账户发出，需要执行合约代码，验证交易的参数是否正确。

共识组
每个账户在生成一条链时，需要指定一个共识规则。没有显式指定的将根据系统默认规则进行分配。共识规则同时也约定了谁是该链的合法出块者。具有同一共识规则的一条链或一组链，称为一个共识组(Consensus Group)。
共识组有私有共识组、公有共识组、局部共识组三种。

私有共识组
私有共识组(Private Consensus Group)的区块生成方式是通过一个私钥对区块进行签名。校验规则是通过账户公钥验证签名是否合法。默认情况下，每一个用户链都是一个私有共识组。除了私钥拥有者外，任何节点无法代替用户在链上添加一个新区块。
用户链上的分叉只可能由用户自己产生，出于双花攻击的目的，或者由程序bug导致。在发生分叉的情况下，裁判者不会判断链的长短，只会选择第一次接收到的区块所在的分叉。一旦用户的交易被裁判者写入快照链，后续即使广播一个更长的分叉链，也不会被采纳。因此，用户的出入账交易一旦被写入快照链，就可以认为该交易被系统确认。当然，由于快照链本身也存在回滚的可能，因此，可以等待快照链继续增长，当交易的确认数大于某个阈值的时候，就可以认为该交易被可靠确认。

公有共识组
大部分智能合约默认被部署在共有共识组(Public Consensus Group)，这个共识组是由一系列合约链构成，其作用类似于主链-侧链结构中的主链。公有共识组的共识规则基于DPOS算法，称为MCDPOS(Multi-Chain Delegated Proof of Stake)，在DPOS算法的基础上做了一些扩展，主要是为了支持多链结构下的共识。
用户通过一个投票机制，按持有VT作为权重，选出21个公有共识组代理节点，这些节点以随机的顺序轮流生成共识组中各合约链上的响应块。
由于共识算法一致，为提高系统效率，在实现时我们可以将裁判者节点同时作为共有共识组的代理节点。因此，共有共识组的出块和快照块出块可以整合为一个统一的流程，节点在自己的轮次中，需要依次完成以下工作：

图：轮次开始


图：轮次结束


读取快照链上的检查点，获取共有共识组所有合约链上的出块进度；
扫描账本中所有目标是本共识组的开放请求区块，计算其优先级，按优先级高低，依次执行目标合约代码，更新合约账户内部状态，并生成对偶的响应区块；
针对智能合约内部的消息调用指令，递归的执行目标合约代码，从而生成一系列请求和响应区块，构成一个调用树，然后调用传输层中批量广播区块的方法，同时广播这一组区块。
作为裁判者，对其他共识组的区块进行验证。
在自己轮次的末尾，生成一个新的快照块，将所有账户的余额、每条链上最后一个区块的hash保存到快照块中，包括其他共识组。
如果某个节点错过了自己的轮次，下一个节点将从快照链中获取前一个检查点，继续出块进度。错过出块的非活跃节点，将被剥夺出块资格。

局部共识组
局部共识组(Local Consensus Group)是保障系统扩展性的基础。在交易层或者合约层，都可以针对某些特定合约指定一个个性化的共识规则，从而构成一个局部共识组。可选的共识规则及参数会根据系统的实现进度给出，总体原则是要求裁判者节点可验证共识组是否达成共识。
在局部共识组中，出块节点按照指定的规则生成新块，并在该链上达成局部共识。在被裁判者写入快照链之前，这些局部共识处于未确认状态，会存在回滚的可能。因此，其他共识组中的链会等待RequestBlock被快照，才会生成对应的ResponseBlock，所以跨共识组的交易延迟会比较长。
局部共识组的作用类似于主链-侧链结构中的侧链，可以部署对性能有额外要求的合约，扩展系统功能，或者做为跨链协议中的中继。

共识组内调用与跨共识组调用
在同一个共识组内，合约间的消息调用会遵循EVM同步调用语义，调用结果会即时返回，目标账户的状态更新也与调用者账户的状态更新同步发生。
而跨共识组的合约调用就无法保证同步语义，是一种异步调用语义。这种调用不是即时完成的，被调用合约的账户状态会延迟一定时间才能进行更新。

分叉与确认
每个共识组都可能发生分叉，在被裁判者快照之前，分叉的选取原则是取更长的链。一旦被裁判者写入快照链，交易就成为确认状态。除非快照链本身被回滚，否则这些交易会被永久固化(cermenting)，也就是说，即使出现一条更长的分叉链，这些交易也不会被回滚。

跨链交互
Vite的跨链方案主要是依靠局部共识组来实现。首先在交易层或合约层部署一个桥合约，用于处理系统内部交易和目标链交易之间的映射关系。该合约需要设置一个独立的局部共识组，指定一个共识机制，参与共识的节点称为跨链网关，需要同时成为Vite节点和目标链的全节点，同时监听两侧的交易。
例如，若想在交易层实现Vite代币和以太坊ERC20代币之间的互转，可以通过如下方式实现：
首先在价值层发行一个token，作为目标代币在Vite内部的代币，称为TOT(Token of Token)。
当用户希望将以太坊上的代币转入Vite时，可以向以太坊桥合约地址发送一笔交易，将该用户在Vite上的地址放在参数中。以太坊桥合约收到该交易后，代币余额会锁定在合约账户，用户无法在以太坊上转走这部分代币。而网关节点监听到该笔交易之后，会生成一笔与之对应的Vite交易，将同样数量的TOT存入该用户在Vite的账户中。
反向流程与此类似，当用户从Vite账户向以太坊账户转账时，会发送一个交易给Vite上的桥合约，转入一定数量的TOT。
由于所有网关节点都会监听目标网络，这些节点能够校验生成的映射交易是否正确，并在共识组内部达成共识。
但裁判者节点只会验证这些交易是否由共识组内合法的出块节点生成，是否遵循了预先指定的共识规则，是否发生分叉，是否存在双花交易等。但不会监听目标链的交易，也不会验证交易在两条链之间是否正确映射。
如果目标网络回滚了一个交易，或者发生了硬分叉，该交易在Vite系统中无法随之回滚。也就是说，这种跨链映射是单向的。同样，Vite中发往桥合约的交易被回滚，我们也无法同步回滚目标网络的映射交易。因此，在做跨链交易的时候，需要在合约逻辑中处理交易回滚的情况。


限流
由于Vite是一个无手续费的平台，有效的限流机制将极大降低系统被滥用和攻击的风险。
限流机制的设定需要考虑如下因素：
任何用户不能无限制的发布交易和消息；
满足不同应用场景对流量配额的不同需求；
允许用户选择不同的方式，换取更高的流量配额；


量化TPS
有效限流机制的前提是准确的量化一个账户的TPS。幸运的是，由于快照链的存在，我们拥有了一个全局时钟，使TPS的量化成为可能。
一个账户链上高度为n的交易，其最近10笔交易的平均TPS为：
TPS(n) = 10 / ((H(n) - H(n-9) + 1) * S)

其中，H(n)为交易Tn所引用的快照块的高度，S为快照块的出块间隔，单位为秒。

TPS配额

一个用户账户的TPS配额根据如下公式计算：


$$Q_{tps} = T \cdot \left ( \frac{2}{1+exp\left ( -P_{d}\cdot D - P_{s}\cdot S - P_{b}\cdot B \right )} - 1  \right )$$


其中，T为一个常数，代表单个账户TPS配额的上限，和系统总吞吐以及账户总数相关。D是一个交易或消息的PoW难度。S是用户账户中VT的余额，代表用户对整个系统拥有的股权(stake)。显然，持有更多的VT，将获得更大的TPS；B是用户愿意为提高交易TPS所支付的一次性费用，将从用户的VT余额中扣除。不同于手续费，这部分VT将直接销毁，而不是支付给矿工。
因此，用户获取更高的TPS有三个途径：提高PoW难度，在账户中保留更多的VT，或者一次性销毁少量VT；

智能合约限流
在发送消息进行合约调用时，由于每个目标合约的代码逻辑不同，所消耗的计算和存储资源也不同，因此针对消息不能仅仅简单的限制TPS，而需要进一步计算每次合约调用的成本。
与以太坊通过消耗用户支付的gas作为控制资源使用的手段不同，我们认为优化合约的资源利用率的责任不在用户，而在合约的开发者。因此，我们将对每个合约账户的资源使用进行限制。
在Vite的EVM中，和计算gas的方式类似，也会计算每一条指令的cost。根据合约部署者所持有的VT余额，分配一个单位时间内该合约账户累计cost的上限。一旦达到这个上限，任何对该合约的请求将不再得到响应，也就是说，发往该合约的消息不再被出块节点处理并生成对应的响应块。
这个机制确保整个系统不会被错误的编码或恶意合约所阻塞，而比较重要的合约，开发者可以通过持有更多的VT，或者优化合约代码降低cost，来换取更多的TPS。

总结
Vite采用分层结构，在价值层支持多种代币的转账；在交易层内置支持资产发行、去中心化交易、环路撮合交易等高级交易功能；在合约层支持图灵完备的智能合约，并兼容EVM。
在Vite系统中，用户发送交易不需要支付手续费或gas。
由于采用了DAG结构的账本和对偶块的设计，彼此不相关的交易不会互相阻塞，有利于提高系统的吞吐。
引入了快照链结构，加强了系统的安全性，为区块裁剪提供了便利，也使有效的限流手段成为可能。与Nano等同样采用DAG账本的系统相比，即不需要因为提高PoW的难度而伤及正常用户，也对预计算攻击(Precomputation Attack)等较难防范的攻击手段免疫。
Vite的分层共识机制保证了系统的扩展性，更好的支持高频应用、Oracle、跨链交互等场景。
